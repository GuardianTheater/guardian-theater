<div class="activity">
  <div *ngIf="activity" class="columns small-12" (click)="toActivity(activity.activityDetails.instanceId)">
    <div class="mode row align-justify mode-no-clips">
      <span class="ng-binding">{{ activity.activityDetails.mode | activityMode }} </span>
      <span class="activity-time">{{ activity.period | date:'medium' }}</span>
    </div>
  </div>

  <div *ngIf="!pgcr">
    <span class="player-spinner">
      <span class="fi-widget spinner bungie-spinner" title="Fetching Bungie PGCR..."></span>
    </span>
  </div>

  <div *ngIf="pgcr">
    <span *ngFor="let entry of pgcr.entries">
      <span class="player-spinner"
        *ngIf="(entry.player.bungieNetUserInfo && twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] && !(twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] | async).checkedId)
            || (entry.player.bungieNetUserInfo && twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] && !(twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] | async).checkedResponse)
            || (xboxService.xbox[entry.player.destinyUserInfo.displayName] && !(xboxService.xbox[entry.player.destinyUserInfo.displayName] | async).checked)" >
        <span class="fi-widget spinner bungie-spinner" [title]="'Fetching TwitchID for ' + entry.player.destinyUserInfo.displayName"
          [ngClass]="{
            'half-spinner-a': (entry.player.bungieNetUserInfo && twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] && !(twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] | async).checkedResponse)
                           || (xboxService.xbox[entry.player.destinyUserInfo.displayName] && !(xboxService.xbox[entry.player.destinyUserInfo.displayName] | async).checked),
            'third-spinner-a': (entry.player.bungieNetUserInfo && twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] && !(twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] | async).checkedResponse)
                           && (xboxService.xbox[entry.player.destinyUserInfo.displayName] && !(xboxService.xbox[entry.player.destinyUserInfo.displayName] | async).checked)
          }"
          *ngIf="entry.player.bungieNetUserInfo && twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] && !(twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] | async).checkedId"></span>
        <span class="fi-widget spinner twitch-spinner" [title]="'Fetching Twitch clips for ' + entry.player.destinyUserInfo.displayName"
          [ngClass]="{
            'half-spinner-b': entry.player.bungieNetUserInfo && twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] && !(twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] | async).checkedId,
            'half-spinner-a': xboxService.xbox[entry.player.destinyUserInfo.displayName] && !(xboxService.xbox[entry.player.destinyUserInfo.displayName] | async).checked,
            'third-spinner-b': (entry.player.bungieNetUserInfo && twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] && !(twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] | async).checkedId)
                           && (xboxService.xbox[entry.player.destinyUserInfo.displayName] && !(xboxService.xbox[entry.player.destinyUserInfo.displayName] | async).checked)
          }"
          *ngIf="entry.player.bungieNetUserInfo && twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] && !(twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] | async).checkedResponse"></span>
        <span class="fi-widget spinner xbox-spinner" [title]="'Fetching Xbox clips for ' + entry.player.destinyUserInfo.displayName"
          [ngClass]="{
            'half-spinner-b': (entry.player.bungieNetUserInfo && twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] && !(twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] | async).checkedResponse)
                           || (entry.player.bungieNetUserInfo && twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] && !(twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] | async).checkedId),
            'third-spinner-c': (entry.player.bungieNetUserInfo && twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] && !(twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] | async).checkedResponse)
                           && (entry.player.bungieNetUserInfo && twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] && !(twitchService.twitch[entry.player.bungieNetUserInfo.membershipId] | async).checkedId)
          }"
          *ngIf="xboxService.xbox[entry.player.destinyUserInfo.displayName] && !(xboxService.xbox[entry.player.destinyUserInfo.displayName] | async).checked"></span>
      </span>
    </span>
    <div *ngFor="let entry of pgcr.entries">
      <div *ngFor="let clip of entry.twitchClips">
        <span (click)="toGuardian(entry.player.destinyUserInfo.displayName, entry.characterId)">{{ entry.player.destinyUserInfo.displayName }}</span>
        <div class="clip-wrapper" *ngIf="!entry.play">
          <img class="clip-thumbnail" (click)="entry.play = !entry.play" [src]="clip.thumbnails[0].url">
        </div>
        <div class="clip-wrapper" *ngIf="entry.play">
          <iframe
            class="twitch-embed"
            [src]="clip.embedUrl"
            frameborder="0"
            scrolling="no"
            allowfullscreen="true">
          </iframe>
        </div>
      </div>
      <div *ngFor="let clip of entry.xboxClips">
        <span (click)="toGuardian(entry.player.destinyUserInfo.displayName, entry.characterId)">{{ entry.player.destinyUserInfo.displayName }}</span>
        <div class="clip-wrapper">
          <video id="my-video" class="video-js twitch-embed" controls preload="metadata" [poster]="clip.thumbnails[0].uri" data-setup="{}">
            <source [src]="clip.gameClipUris[0].uri" type="video/mp4">
          </video>
        </div>
      </div>
    </div>
  </div>
</div>

